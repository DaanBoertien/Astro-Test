---
import Layout from '../layouts/Layout.astro';
import { loadSite, loadPages, t } from '../lib/content';

import Hero from '../components/sections/Hero.astro';
import TextBlock from '../components/sections/TextBlock.astro';
import TextImage from '../components/sections/TextImage.astro';
import ConcertList from '../components/sections/ConcertList.astro';
import ContactForm from '../components/sections/ContactForm.astro';
import CallToAction from '../components/sections/CallToAction.astro';
import ListSection from '../components/sections/ListSection.astro';

const sectionComponents: Record<string, any> = {
  'hero': Hero,
  'text': TextBlock,
  'text-image': TextImage,
  'concert-list': ConcertList,
  'contact-form': ContactForm,
  'cta': CallToAction,
  'list': ListSection,
};

export async function getStaticPaths() {
  const site = loadSite();
  const pages = loadPages();
  const paths: any[] = [];

  for (const page of pages) {
    for (const locale of site.locales) {
      let path: string | undefined;

      if (locale === site.defaultLocale) {
        path = page.slug || undefined;
      } else {
        path = page.slug ? `${locale}/${page.slug}` : locale;
      }

      paths.push({
        params: { path },
        props: { page, locale },
      });
    }
  }

  return paths;
}

const { page, locale } = Astro.props;
const site = loadSite();
const pageTitle = t(page.title, locale);
const title = page.slug === ''
  ? `${site.siteTitle} — ${pageTitle}`
  : `${pageTitle} — ${site.siteTitle}`;
---

<Layout title={title} locale={locale}>
  {page.sections.map(section => {
    const Component = sectionComponents[section.type];
    return Component ? (
      <Component
        section={section}
        locale={locale}
        pageSlug={page.slug || 'home'}
      />
    ) : null;
  })}
</Layout>
